services:
  # Run all tests (unit + integration)
  test:
    build:
      context: ..
      dockerfile: skill-tools/Dockerfile.test
    command: ["cargo", "test", "-p", "skill-tools"]
    volumes:
      - cargo-cache:/home/testuser/.cargo/registry
      - cargo-git:/home/testuser/.cargo/git
    environment:
      - RUST_BACKTRACE=1
      - CARGO_TERM_COLOR=always

  # Run integration tests only
  integration:
    build:
      context: ..
      dockerfile: skill-tools/Dockerfile.test
    command: ["cargo", "test", "-p", "skill-tools", "--test", "integration_tests"]
    volumes:
      - cargo-cache:/home/testuser/.cargo/registry
      - cargo-git:/home/testuser/.cargo/git
    environment:
      - RUST_BACKTRACE=1
      - CARGO_TERM_COLOR=always

volumes:
  cargo-cache:
  cargo-git:
