# searching-skills test cases
desc: "æ¤œç´¢ã‚¹ã‚­ãƒ«ã®ãƒ†ã‚¹ãƒˆ - æ¤œç´¢ã¨è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½"

# === å†åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© ===
assertions:
  has-numbered-list:
    desc: "ç•ªå·ä»˜ããƒªã‚¹ãƒˆå½¢å¼"
    type: regex
    pattern: "\\d+\\."
    expect: present

  has-score:
    desc: "ã‚¹ã‚³ã‚¢è¡¨ç¤º (X/35å½¢å¼)"
    type: regex
    pattern: "\\d+/35"
    expect: present

  has-security-indicator:
    desc: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŒ‡æ¨™"
    type: regex
    pattern: "ğŸ”’|âš ï¸|ğŸš¨|Security"
    expect: present

  has-source-url:
    desc: "ã‚½ãƒ¼ã‚¹URL"
    type: regex
    pattern: "https?://"
    expect: present

  has-skill-name:
    desc: "ã‚¹ã‚­ãƒ«åï¼ˆå¤ªå­—ï¼‰"
    type: regex
    pattern: "\\*\\*[^*]+\\*\\*"
    expect: present

  has-purpose:
    desc: "ç›®çš„/èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³"
    type: regex
    pattern: "Purpose:|What it does|Description:|èª¬æ˜"
    expect: present

  has-multiple-results:
    desc: "è¤‡æ•°çµæœã®è¡¨ç¤º"
    type: regex
    pattern: "Found|ç™ºè¦‹|ä»¶"
    expect: present

  has-configuration:
    desc: "è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³"
    type: regex
    pattern: "Configuration:|allowed-tools|è¨­å®š"
    expect: present

  has-workflow:
    desc: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼/ä½¿ã„æ–¹"
    type: regex
    pattern: "How it works|Workflow|å‹•ä½œ|ä½¿ã„æ–¹"
    expect: present

  has-usage:
    desc: "ä½¿ç”¨æ–¹æ³•"
    type: regex
    pattern: "Usage:|ä½¿ç”¨|ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
    expect: present

  has-updated-date:
    desc: "æ›´æ–°æ—¥"
    type: regex
    pattern: "Updated:|\\d{4}-\\d{2}-\\d{2}"
    expect: present

# === ã‚·ãƒŠãƒªã‚ªå®šç¾© ===
scenarios:
  # === Phase 1: Search and list ===

  search-basic-ja:
    desc: "åŸºæœ¬æ¤œç´¢ï¼ˆæ—¥æœ¬èªï¼‰"
    prompt: "Claude Codeã®ã‚¹ã‚­ãƒ«ã‚’æ¢ã—ã¦"
    assertions:
      - has-numbered-list
      - has-score
      - has-security-indicator
      - has-source-url
      - has-skill-name
    golden_assertions:
      - has-purpose
      - has-multiple-results
      - id: results-relevant-ja
        desc: "æ¤œç´¢çµæœã®é–¢é€£æ€§"
        type: llm_eval
        pattern: |
          ä»¥ä¸‹ã®å‡ºåŠ›ã«ã€Claude Codeã®ã‚¹ã‚­ãƒ«ã®æ¤œç´¢çµæœãƒªã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
          ãƒªã‚¹ãƒˆã«ã¯ç•ªå·ä»˜ãã®ã‚¹ã‚­ãƒ«åã€èª¬æ˜ã€ã‚¹ã‚³ã‚¢ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
          YESã¾ãŸã¯NOã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

          å‡ºåŠ›:
          {{output}}
        expect: pass

  search-basic-en:
    desc: "åŸºæœ¬æ¤œç´¢ï¼ˆè‹±èªï¼‰"
    prompt: "Find Claude Code skills"
    assertions:
      - has-numbered-list
      - has-score
      - has-security-indicator
      - has-source-url
      - has-skill-name
    golden_assertions:
      - has-purpose
      - has-multiple-results
      - id: results-relevant-en
        desc: "æ¤œç´¢çµæœã®é–¢é€£æ€§"
        type: llm_eval
        pattern: |
          Does the output contain a list of Claude Code skills search results?
          The list should include numbered skill names, descriptions, and scores.
          Answer YES or NO.

          Output:
          {{output}}
        expect: pass

  search-topic-testing:
    desc: "ãƒˆãƒ”ãƒƒã‚¯æ¤œç´¢ï¼šãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–"
    prompt: "ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã®ã‚¹ã‚­ãƒ«ã‚’æ¤œç´¢ã—ã¦"
    assertions:
      - has-numbered-list
      - has-score
    golden_assertions:
      - id: results-match-testing
        desc: "ãƒ†ã‚¹ãƒˆé–¢é€£ã‚¹ã‚­ãƒ«ã®æ¤œå‡º"
        type: llm_eval
        pattern: |
          ä»¥ä¸‹ã®æ¤œç´¢çµæœãƒªã‚¹ãƒˆã«ã€ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã«é–¢é€£ã™ã‚‹ã‚¹ã‚­ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
          ï¼ˆãƒ†ã‚¹ãƒˆã€TDDã€unit testã€integration testç­‰ã«é–¢é€£ã™ã‚‹ã‚¹ã‚­ãƒ«ï¼‰
          YESã¾ãŸã¯NOã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

          å‡ºåŠ›:
          {{output}}
        expect: pass

  search-topic-deploy:
    desc: "ãƒˆãƒ”ãƒƒã‚¯æ¤œç´¢ï¼šãƒ‡ãƒ—ãƒ­ã‚¤"
    prompt: "Search for deployment skills"
    assertions:
      - has-numbered-list
      - has-score
    golden_assertions:
      - id: results-match-deploy
        desc: "ãƒ‡ãƒ—ãƒ­ã‚¤é–¢é€£ã‚¹ã‚­ãƒ«ã®æ¤œå‡º"
        type: llm_eval
        pattern: |
          Does the search results list contain skills related to deployment?
          (deploy, CI/CD, release, shipping, etc.)
          Answer YES or NO.

          Output:
          {{output}}
        expect: pass

  search-topic-review:
    desc: "ãƒˆãƒ”ãƒƒã‚¯æ¤œç´¢ï¼šã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼"
    prompt: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¹ã‚­ãƒ«ã‚’æ¢ã—ã¦"
    assertions:
      - has-numbered-list
      - has-score
    golden_assertions:
      - id: results-match-review
        desc: "ãƒ¬ãƒ“ãƒ¥ãƒ¼é–¢é€£ã‚¹ã‚­ãƒ«ã®æ¤œå‡º"
        type: llm_eval
        pattern: |
          ä»¥ä¸‹ã®æ¤œç´¢çµæœãƒªã‚¹ãƒˆã«ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«é–¢é€£ã™ã‚‹ã‚¹ã‚­ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
          ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã€PRã€pull requestç­‰ã«é–¢é€£ã™ã‚‹ã‚¹ã‚­ãƒ«ï¼‰
          YESã¾ãŸã¯NOã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

          å‡ºåŠ›:
          {{output}}
        expect: pass

  # === Phase 2: Detail display ===

  detail-select-number:
    desc: "è©³ç´°è¡¨ç¤ºï¼šç•ªå·æŒ‡å®š"
    prompt: "Claude Codeã®ã‚¹ã‚­ãƒ«ã‚’æ¢ã—ã¦ã€1ç•ªç›®ã®ã‚¹ã‚­ãƒ«ã®è©³ç´°ã‚’æ•™ãˆã¦"
    assertions:
      - has-numbered-list
    golden_assertions:
      - has-configuration
      - has-workflow
      - has-usage
      - id: shows-detail-ja
        desc: "è©³ç´°èª¬æ˜ã®å®Œå…¨æ€§"
        type: llm_eval
        pattern: |
          ä»¥ä¸‹ã®å‡ºåŠ›ã«ã€ã‚¹ã‚­ãƒ«ã®è©³ç´°èª¬æ˜ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
          è©³ç´°ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:
          - ã‚¹ã‚­ãƒ«ã®ç›®çš„/èª¬æ˜
          - ä½¿ã„æ–¹/Usage
          - è¨­å®š/Configurationï¼ˆallowed-toolsç­‰ï¼‰
          YESã¾ãŸã¯NOã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

          å‡ºåŠ›:
          {{output}}
        expect: pass

  detail-explain-specific:
    desc: "è©³ç´°è¡¨ç¤ºï¼šãƒˆãƒƒãƒ—çµæœã®èª¬æ˜"
    prompt: "Find skills for testing and explain how the top result works"
    assertions:
      - has-numbered-list
    golden_assertions:
      - has-configuration
      - has-updated-date
      - id: shows-workflow-en
        desc: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼èª¬æ˜ã®æ¤œå‡º"
        type: llm_eval
        pattern: |
          Does the output contain a detailed explanation of how the skill works?
          It should include workflow/steps and configuration details.
          Answer YES or NO.

          Output:
          {{output}}
        expect: pass
