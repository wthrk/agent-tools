[config]
default_to_workspace = false

[tasks.build]
description = "Build the project"
command = "cargo"
args = ["build", "--release"]

[tasks.test]
description = "Run unit tests"
command = "cargo"
args = ["test", "--workspace"]

[tasks.test-integration]
description = "Run integration tests (requires Claude CLI)"
command = "cargo"
args = ["test", "-p", "skill-test", "--features", "integration-test", "--test", "cli_tests"]

[tasks.test-all]
description = "Run all tests including integration tests"
dependencies = ["test", "test-integration"]

[tasks.check]
description = "Check the project for errors"
command = "cargo"
args = ["check", "--workspace"]

[tasks.clippy]
description = "Run clippy lints"
command = "cargo"
args = ["clippy", "--workspace", "--all-targets", "--", "-D", "warnings"]

[tasks.fmt]
description = "Format code"
command = "cargo"
args = ["fmt", "--all"]

[tasks.fmt-check]
description = "Check code formatting"
command = "cargo"
args = ["fmt", "--all", "--check"]

[tasks.ci]
description = "Run all CI checks"
dependencies = ["fmt-check", "clippy", "test"]

[tasks.ci-full]
description = "Run all CI checks including integration tests"
dependencies = ["fmt-check", "clippy", "test-all"]

[tasks.skill-test]
description = "Run skill tests (pass args with: cargo make skill-test -- <args>)"
script = '''
#!/bin/bash
if [ $# -eq 0 ]; then
  cargo run -p skill-test --release -- skills/*
else
  cargo run -p skill-test --release -- "$@"
fi
'''
